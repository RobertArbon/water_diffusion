
proc save_viewpoint {} {
global viewpoints
if [info exists viewpoints] {unset viewpoints}
# get the current matricies
foreach mol [molinfo list] {
set viewpoints($mol) [molinfo $mol get {
center_matrix rotate_matrix scale_matrix global_matrix}]
}
}


set dir msm_10ps/output_3

# Load the trajectories

mol new $dir/all_clusters.pdb waitfor all autobonds off

set cluster_paths [glob -join -dir $dir *_cluster.pdb]


# Change background and remove axes
color Display Background 8
axes location off
mol top 0

# save current viewpoint

save_viewpoint

# all_clusters
mol modmaterial 0 top Diffuse
mol modstyle 0 top VDW 0.1 30
mol modcolor 0 top ColorID 2
pbc box_draw -center bb -color black

# The other clusters
set count 1
foreach i $cluster_paths {
  # load 
  mol new $i waitfor all  
  mol top $count


  # change color and style
  mol modmaterial 0 top Diffuse
  mol modstyle 0 top VDW 0.2 30
  mol modcolor 0 top Beta

  # Restore viewpoint
  foreach mol [molinfo list] {
	molinfo	$mol set {center_matrix rotate_matrix scale_matrix
		global_matrix} $viewpoints(0)
  }
 
  set froot [file tail $i]

  # Render xy
  foreach mol [molinfo list] {
	molinfo	$mol set rotate_matrix [list {{1 0 0 0} {0 1 0 0} {0 0 1 0} {0 0 0 1}}]
  }
  set fname [regsub ".pdb" $froot "-xy.tga"]
  render snapshot $fname

  # Render yz
  foreach mol [molinfo list] {
	molinfo	$mol set rotate_matrix [list {{0 0 -1 0} {0 1 0 0} {1 0 0 0} {0 0 0 1}}]
  }
  set fname [regsub ".pdb" $froot "-yz.tga"]
  render snapshot $fname

  # Render zx
  foreach mol [molinfo list] {
	molinfo	$mol set rotate_matrix [list {{0 0 -1 0} {-1 0 0 0} {0 1 0 0} {0 0 0 1}}]
  }
  set fname [regsub ".pdb" $froot "-zx.tga"]
  render snapshot $fname

  mol delete $count
  incr count 1
}



 


